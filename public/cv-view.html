<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Curriculum Vitae</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
            padding: 20px;
        }

        .cv-container {
            max-width: 210mm;
            margin: 0 auto;
            background: white;
            padding: 40px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        .cv-header {
            text-align: center;
            border-bottom: 3px solid #2c3e50;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        .cv-header h1 {
            font-size: 32px;
            color: #2c3e50;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .contact-info {
            font-size: 14px;
            color: #555;
            line-height: 1.8;
        }

        .cv-section {
            margin-bottom: 30px;
        }

        .cv-section h2 {
            font-size: 20px;
            color: #2c3e50;
            text-transform: uppercase;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
            margin-bottom: 15px;
            letter-spacing: 1px;
        }

        .cv-content {
            font-size: 14px;
            color: #444;
            white-space: pre-wrap;
            line-height: 1.8;
        }

        .no-print {
            text-align: center;
            margin-bottom: 20px;
        }

        .btn {
            display: inline-block;
            padding: 10px 20px;
            margin: 0 5px;
            background-color: #3498db;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
            border: none;
        }

        .btn:hover {
            background-color: #2980b9;
        }

        .btn-secondary {
            background-color: #95a5a6;
        }

        .btn-secondary:hover {
            background-color: #7f8c8d;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .cv-container {
                box-shadow: none;
                padding: 20px;
            }
            
            .no-print {
                display: none;
            }
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
        }

        .error {
            text-align: center;
            padding: 50px;
            color: #e74c3c;
        }
    </style>
</head>
<body>
    <div class="no-print">
        <button onclick="window.print()" class="btn">Print CV</button>
        <button onclick="downloadCV()" class="btn btn-secondary">Download PDF</button>
    </div>

    <div id="loading" class="loading">
        <h2>Loading CV...</h2>
    </div>

    <div id="error" class="error" style="display: none;">
        <h2>Error Loading CV</h2>
        <p>The CV could not be found or has not been submitted yet.</p>
    </div>

    <div id="cvContainer" class="cv-container" style="display: none;">
        <div class="cv-header">
            <h1 id="cvName">CURRICULUM VITAE</h1>
            <div class="contact-info" id="contactInfo"></div>
        </div>

        <div id="profileSection" class="cv-section" style="display: none;">
            <h2>PROFILE</h2>
            <div class="cv-content" id="profileContent"></div>
        </div>

        <div id="experienceSection" class="cv-section" style="display: none;">
            <h2>EXPERIENCE</h2>
            <div class="cv-content" id="experienceContent"></div>
        </div>

        <div id="educationSection" class="cv-section" style="display: none;">
            <h2>EDUCATION AND QUALIFICATIONS</h2>
            <div class="cv-content" id="educationContent"></div>
        </div>

        <div id="personalSection" class="cv-section" style="display: none;">
            <h2>PERSONAL DETAILS</h2>
            <div class="cv-content" id="personalContent"></div>
        </div>

        <div id="referencesSection" class="cv-section" style="display: none;">
            <h2>REFERENCES</h2>
            <div class="cv-content" id="referencesContent"></div>
        </div>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get('token');

        if (!token) {
            showError();
        } else {
            loadCV();
        }

        async function loadCV() {
            try {
                const response = await fetch(`/api/cv/${token}`);
                const data = await response.json();

                if (data.error) {
                    showError();
                    return;
                }

                renderCV(data.cvData);
            } catch (error) {
                console.error('Error loading CV:', error);
                showError();
            }
        }

        function renderCV(cvData) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('cvContainer').style.display = 'block';

            // Header
            if (cvData.header && cvData.header.fullName) {
                document.getElementById('cvName').textContent = cvData.header.fullName.toUpperCase();
                
                let contactHTML = '';
                if (cvData.header.address) contactHTML += cvData.header.address + '<br>';
                if (cvData.header.city) contactHTML += cvData.header.city + '<br>';
                if (cvData.header.mobile) contactHTML += 'M: ' + cvData.header.mobile + '<br>';
                if (cvData.header.email) contactHTML += 'E: ' + cvData.header.email;
                
                document.getElementById('contactInfo').innerHTML = contactHTML;
            }

            // Profile
            if (cvData.profile && cvData.profile.trim()) {
                document.getElementById('profileSection').style.display = 'block';
                document.getElementById('profileContent').textContent = cvData.profile;
            }

            // Experience
            if (cvData.experience && cvData.experience.trim()) {
                document.getElementById('experienceSection').style.display = 'block';
                document.getElementById('experienceContent').textContent = cvData.experience;
            }

            // Education
            if (cvData.education && cvData.education.trim()) {
                document.getElementById('educationSection').style.display = 'block';
                document.getElementById('educationContent').textContent = cvData.education;
            }

            // Personal Details
            if (cvData.personalDetails && cvData.personalDetails.trim()) {
                document.getElementById('personalSection').style.display = 'block';
                document.getElementById('personalContent').textContent = cvData.personalDetails;
            }

            // References
            if (cvData.references && cvData.references.trim()) {
                document.getElementById('referencesSection').style.display = 'block';
                document.getElementById('referencesContent').textContent = cvData.references;
            }
        }

        function showError() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').style.display = 'block';
        }

        function downloadCV() {
            window.print();
        }
    </script>
</body>
</html>
